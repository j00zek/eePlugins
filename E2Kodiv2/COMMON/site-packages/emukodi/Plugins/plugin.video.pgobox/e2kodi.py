#contains own functions to minimize modifications of the oryginal script
import e2kodi__init__ # aby zainicjowac sciezki i nie musiec zmieniac czegos w kodzie

import os, sys
from urllib.parse import parse_qsl

from xbmcE2 import *

import xbmc
import xbmcaddon
import xbmcgui
import xbmcplugin
import xbmcvfs

params = dict(parse_qsl(sys.argv[2][1:]))

mode = params.get('mode', None)

if __name__ == '__main__':
    if len(params) <1:
        print('brak parametrów uruchomieniowych :(')
    elif not mode is None:
        if mode=='listE2B':
            from main import IPLA
            
            addon = xbmcaddon.Addon(id='plugin.video.pgobox')
            
            xbmcgui.Dialog().notification('Polsat Box Go', 'Generuję listę E2B.', xbmcgui.NOTIFICATION_INFO)

            for item in IPLA().getChannels():
                channelid = item.get('url', None)
                if 'tv' not in channelid:
                    channelid+='%7Ctv'
                list_title = self.decode_byte(item.get('title', '')) + ' PL'
                title = self.decode_byte(item.get('title', ''))
                img = self.decode_byte(item.get('img', ''))
                data += '\n#EXTINF:-1,{}\nplugin://plugin.video.pgobox/?mode=playtvs&url={}&page=0&moviescount=0&movie=True&name={}&image={}'.format(list_title, channelid, title, img)

            f = xbmcvfs.File(os.path.join(working_dir, 'iptv.e2b'), 'w') #j00zek for E2 bouquets
            f.write(dataE2)
            f.close()
            xbmcgui.Dialog().notification('Polsat Box Go', 'Wygenerowano listę E2B', xbmcgui.NOTIFICATION_INFO)
