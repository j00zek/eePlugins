#contains own functions to minimize modifications of the oryginal script
import e2kodi__init__ # aby zainicjowac sciezki i nie musiec zmieniac czegos w kodzie

import os, sys
from urllib.parse import parse_qsl

from xbmcE2 import *

import xbmc
import xbmcaddon
import xbmcgui
import xbmcplugin
import xbmcvfs

params = dict(parse_qsl(sys.argv[2][1:]))

mode = params.get('mode', None)

if __name__ == '__main__':
    if len(params) <1:
        print('brak parametrów uruchomieniowych :(')
    elif not mode is None:
        if mode=='listE2B':
            from main import IPLA
            
            addon = xbmcaddon.Addon(id='plugin.video.netiago')
            E2Bfilename = '/tmp/.emukodi/iptv.e2b'
            dataE2 = '' #j00zek for E2 bouquets
            
            xbmcgui.Dialog().notification('Netia Go', 'Generuję listę E2B.', xbmcgui.NOTIFICATION_INFO)
            
            for item in IPLA().getChannels():
                channelid = item.get('url', None)
                title = IPLA().decode_byte(item.get('title', ''))

                dataE2 += 'plugin.video.netiago/main.py?mode=playtvs&url=%s&page=0&moviescount=0&movie=True:%s\n' % (channelid, title) #j00zek for E2 bouquets

            f = xbmcvfs.File(E2Bfilename, 'w') #j00zek for E2 bouquets
            f.write(dataE2)
            f.close()
            xbmcgui.Dialog().notification('Netia Go', 'Wygenerowano listę E2B', xbmcgui.NOTIFICATION_INFO)
